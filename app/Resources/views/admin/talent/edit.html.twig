{% extends 'admin/admin.base.html.twig' %}


{% block breadcrumb %}
    {{ parent() }}
    <li><a href="{{ path('admin_talent_list') }}" class="active">Talent</a></li>
{% endblock %}

{% block body %}
<h1>Talent edit</h1>

<div class="container form">
    <form id="upld-main" method="post" action="{{ path('admin-talent-main-image') }}" enctype="multipart/form-data">
        <div class="row">
            <div class="col-xs-2">
                <label>Main image</label>
                <div  id="drop-main">                    
                    <a title="upload"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDN0E2NUJEQjZCRjIxMUU1QjFFM0Q5QUE2OUM0Qzk0OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDN0E2NUJEQzZCRjIxMUU1QjFFM0Q5QUE2OUM0Qzk0OCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM3QTY1QkQ5NkJGMjExRTVCMUUzRDlBQTY5QzRDOTQ4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM3QTY1QkRBNkJGMjExRTVCMUUzRDlBQTY5QzRDOTQ4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+iW8uSwAAA/ZJREFUeNrMmVtIVkEQgI9dtZtpJUGSVEZ2pSjLLqIkQkJE2E3QKIqwsofqIaIIJAgkkC5Q0EtKRCARYfYUFGkXq4cQTS2SLDOLErOLaab+zeKcOA6zp909//l14IP+4+7snGl2Z3ZOmOVNwoEkIBVYCMwBpgJjgeHAT+Az0ADUAhXID2sQZDVQhIsHNOkCbgIbgGGhMDYNeGRgqIw6IAsI88NY8V9eEkRjKeXAXFVjVN4wHbiChnPSDTzFhUXcNmIs92FsxwEJwBogGZ9x8gvIA4q9eng/0CPxzksgF5iooS8C2AZUuni90Eu4HJMobQFygrCJ0jGmuTUum+jfJ1F2DYgM4l4ZBRRgKNG1LuooSmZCQig95OOptBFjmhq+S2XyJKCZMXhHCI5T4awOsnaHyqlSxLzt0RAmLZFwesn6lW4bM5GJrRKDhVcCVcA7YIvB/FOM47bLBpeRga0YLjqyBGh36OhB7+nICKCG2PKKO03mMV7eq7lYPBZHASYukzR1pTB6NtNBp8mA93gcqcoU4LVLwmjHKlBHyomOMjqAnhjHNZSPAZ4o1BfCEbEaejPJfFEuRDtDgx5xcRrJ4ZZGYVStkZyE7jYyP1OW/V5oFFtXDSq6uxqhd53MPW/hjlxABj5UVJgPZDNhZv3n2Vp8WRV5QH7/s/UOeZsDCsqigD+SzUY9u1yySRMViyrnnGbb07RObjKoxbsx3mqYcZ+ADOALea5Sxb0lv2PsfzSSt0lRNPogGtvm3CCMR6fj82V4goiEc0HjxkT1jbYw3TofJmsW9SPJM5nRFt7QwzX0xzD6IkTK/EYGTtBQ2qmZMHoRVRnPzO8UcfWV/CHWGjoyjfxutTcDDfaEIWQ0raUbbKOrmUbMUJFV5Heds/4NkHJysoeF3DaijgiHfiC6cpw7us0gwfhtdBpTEw2I8UtkQI2H3kOwjL5B9FRwDcWArKIaBKPnM3fF3dxA2lh8o5kIbGkh+yPKQMc9pkEUwQ3MYLx01mDBrdjLEwXVEYP5uYwdh90m3GaC3yRMRL08zmDeCqZpU8+UCgNkBqZ156ROrIH9ltnMxbhHtRbKktyo1/tosGg9fGTWzddRUsgoEG99wgr+J4edTDtMUIo5RCsbFUvueM+wNvYqs5gGkc19vOVri0gu5yRK+9ATaQaeX2r195+7JbpLZcebjoiU3uVyu27CjJqNsRntyKaR2KLYBJyx+j9vBFwcUYBtsaDIYuC55d+HIlEer/NjhwsP5DHdKC+I4/WkafzqiLhY7gEeezC2HrNlpOlm8yLx2JtIBRYBM5nuUS9enmuxqSg6TFVeFg3zIYTExdj+TPfd6v8U/TuYi/wVYAA4ZEcE2lLOywAAAABJRU5ErkJggg=="/></a>
                    <input type="file" name="upl"/>
                </div>
            </div>
            <div class="col-xs-6">                    
                <ul id="img-list-main">
                    {% if mainImage %}
                        <li class="thumb">
                            <a href="{{ mainImage.image.urlPath(image_url_prefix) }}" title="öffnen" target="_blank"><img src="{{ mainImage.image.urlPath(image_url_prefix) }}" alt="öffnen"/></a>
                            <br/>
                            <a class="remove" href="#" data-id="{{ mainImage.image.id }}" data-main="true" title="löschen"><img src="/img/icons/delete.png" alt="löschen" /></a>
                        </li>
                    {% endif %}
                </ul>
            </div>
                <div class="col-xs-4 err-msg">
                    {% if mainImageValidation %}
                        <ul><li>{{ mainImageValidation }}</li></ul>
                    {% endif %}                  
                </div>
        </div>
    </form>        
    <form id="upld" method="post" action="{{ path('admin-talent-image', { 'tid': id }) }}" enctype="multipart/form-data" >
        <div class="row">
            <div class="col-xs-2">
                <label>Other images</label>
                <div  id="drop">                    
                    <a title="upload"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDN0E2NUJEQjZCRjIxMUU1QjFFM0Q5QUE2OUM0Qzk0OCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDN0E2NUJEQzZCRjIxMUU1QjFFM0Q5QUE2OUM0Qzk0OCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkM3QTY1QkQ5NkJGMjExRTVCMUUzRDlBQTY5QzRDOTQ4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkM3QTY1QkRBNkJGMjExRTVCMUUzRDlBQTY5QzRDOTQ4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+iW8uSwAAA/ZJREFUeNrMmVtIVkEQgI9dtZtpJUGSVEZ2pSjLLqIkQkJE2E3QKIqwsofqIaIIJAgkkC5Q0EtKRCARYfYUFGkXq4cQTS2SLDOLErOLaab+zeKcOA6zp909//l14IP+4+7snGl2Z3ZOmOVNwoEkIBVYCMwBpgJjgeHAT+Az0ADUAhXID2sQZDVQhIsHNOkCbgIbgGGhMDYNeGRgqIw6IAsI88NY8V9eEkRjKeXAXFVjVN4wHbiChnPSDTzFhUXcNmIs92FsxwEJwBogGZ9x8gvIA4q9eng/0CPxzksgF5iooS8C2AZUuni90Eu4HJMobQFygrCJ0jGmuTUum+jfJ1F2DYgM4l4ZBRRgKNG1LuooSmZCQig95OOptBFjmhq+S2XyJKCZMXhHCI5T4awOsnaHyqlSxLzt0RAmLZFwesn6lW4bM5GJrRKDhVcCVcA7YIvB/FOM47bLBpeRga0YLjqyBGh36OhB7+nICKCG2PKKO03mMV7eq7lYPBZHASYukzR1pTB6NtNBp8mA93gcqcoU4LVLwmjHKlBHyomOMjqAnhjHNZSPAZ4o1BfCEbEaejPJfFEuRDtDgx5xcRrJ4ZZGYVStkZyE7jYyP1OW/V5oFFtXDSq6uxqhd53MPW/hjlxABj5UVJgPZDNhZv3n2Vp8WRV5QH7/s/UOeZsDCsqigD+SzUY9u1yySRMViyrnnGbb07RObjKoxbsx3mqYcZ+ADOALea5Sxb0lv2PsfzSSt0lRNPogGtvm3CCMR6fj82V4goiEc0HjxkT1jbYw3TofJmsW9SPJM5nRFt7QwzX0xzD6IkTK/EYGTtBQ2qmZMHoRVRnPzO8UcfWV/CHWGjoyjfxutTcDDfaEIWQ0raUbbKOrmUbMUJFV5Heds/4NkHJysoeF3DaijgiHfiC6cpw7us0gwfhtdBpTEw2I8UtkQI2H3kOwjL5B9FRwDcWArKIaBKPnM3fF3dxA2lh8o5kIbGkh+yPKQMc9pkEUwQ3MYLx01mDBrdjLEwXVEYP5uYwdh90m3GaC3yRMRL08zmDeCqZpU8+UCgNkBqZ156ROrIH9ltnMxbhHtRbKktyo1/tosGg9fGTWzddRUsgoEG99wgr+J4edTDtMUIo5RCsbFUvueM+wNvYqs5gGkc19vOVri0gu5yRK+9ATaQaeX2r195+7JbpLZcebjoiU3uVyu27CjJqNsRntyKaR2KLYBJyx+j9vBFwcUYBtsaDIYuC55d+HIlEer/NjhwsP5DHdKC+I4/WkafzqiLhY7gEeezC2HrNlpOlm8yLx2JtIBRYBM5nuUS9enmuxqSg6TFVeFg3zIYTExdj+TPfd6v8U/TuYi/wVYAA4ZEcE2lLOywAAAABJRU5ErkJggg=="/></a>
                    <input type="file" name="upl" multiple=""/>
                </div>
            </div>
            <div class="col-xs-10">                    
                <ul id="img-list">
                    {% for eimg in images %}
                        <li class="thumb">
                            <a href="{{ eimg.image.urlPath(image_url_prefix) }}" title="öffnen" target="_blank"><img src="{{ eimg.image.thumbnailUrlPath(image_url_prefix) }}" alt="öffnen"/></a><br/>
                            <a class="remove" href="#" data-id="{{ eimg.image.id }}" title="löschen"><img src="/img/icons/delete.png" alt="löschen" /></a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 err-msg">
                {% if imagesValidation %}
                    <ul><li>{{ imagesValidation }}</li></ul>
                {% endif %}
            </div>
        </div>
    </form>
</div>
    
{{ form_start(form, {'attr': {'enctype': 'multipart/form-data'}}) }}
<div class="container form">
    <div class="row">
        <div class="col-xs-12 err-msg">{{ form_errors(form) }}</div>
    </div>

    <div class="row">
        <div class="col-xs-2">
            <label >angebotsname</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.name, { 'attr': {  'placeholder': 'Maximal 32 Zeichen', 'class': 'text-line-fill normal-input', 'maxlength': '32' } }) }}
        </div>        
        <div class="err-msg">{{ form_errors(form.name) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >preis pro stunde (ab)</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.price, { 'attr': { 'class': 'small-input text-box short', 'placeholder': '0', 'min': '10', 'max': '500' }}) }}EUR
        </div>        
        <div class="err-msg">{{ form_errors(form.price) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.requestPrice, { 'attr': { 'disabled': 'disabled' } }) }}
            <label for="form_requestPrice"><span></span>preis nur auf anfrage (auf deine portraitseite nicht sichtbar)</label>
        </div>        
        <div class="err-msg">{{ form_errors(form.price) }}</div>
    </div>
         
    <div class="row">
        <div class="col-xs-2">
            <label >beschreibe dein angebot</label>
        </div>
        <div class="col-xs-6">                                    
            {{ form_widget(form.description, { 'attr': { 'class': 'admin-edit-area', 'placeholder': 'Maximal 500 Zeichen verfügbar' } }) }}
        </div>                
    </div>
        
    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-8">                                    
            {{ form_widget(form.make_sure) }}
            <label for="form_make_sure"><span></span>ich bin berechtigt, das beschriebene angebot auszuüben</label>
        </div>                
        <div class="err-msg">{{ form_errors(form.make_sure) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >video url</label>
        </div>
        <div class="col-xs-6">                                    
            {{ form_widget(form.videoUrl, { 'attr': { 'placeholder': 'Paste Vimeo or Youtube url here', 'style': 'width: 100%' } }) }}            
        </div>                
        <div class="err-msg">{{ form_errors(form.videoUrl) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >strasse</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.street, { 'attr': { 'placeholder': 'Strasse', 'class': 'text-line-fill' } }) }}                        
        </div>                                        
    </div>
        
    <div class="row">
        <div class="col-xs-2">
            <label >ort</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.place, { 'attr': { 'placeholder': 'Ort', 'class': 'text-line-fill' } }) }}                        
        </div>                                        
    </div>


    <div class="row">
        <div class="col-xs-2">
            <label >hausnr</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.number, { 'attr': { 'placeholder': 'Hausnr.', 'class': 'security  text-box short' } }) }}
        </div>                                        
        <div class="err-msg">{{ form_errors(form.number, { 'attr': { 'class': 'err-msg' } }) }}</div>
    </div>


    <div class="row">
        <div class="col-xs-2">
            <label >türnr</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.flatNumber, { 'attr': { 'placeholder': 'Türnr.', 'class': 'security  text-box short' } }) }}
        </div>                                        
        <div class="err-msg">{{ form_errors(form.flatNumber, { 'attr': { 'class': 'err-msg' } }) }}</div>
    </div>


    <div class="row">
        <div class="col-xs-2">
            <label >plz</label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.postcode, { 'attr': { 'placeholder': 'PLZ', 'class':'text-box short' } }) }}
        </div>                                        
        <div class="err-msg">{{ form_errors(form.postcode, { 'attr': { 'class': 'err-msg' } }) }}</div>
    </div>

    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.defaultAddress) }}
            <label for="form_defaultAddress"><span></span>als standardadresse für weitere angebote speichern</label>
        </div>
    </div>
            
    <div class="row">
        <div class="col-xs-2">
            <label>phone</label>
        </div>        
        <div class="col-xs-2">
            {{ form_widget(form.phonePrefix, { 'attr': { 'class': 'text-line-fill  text-box short', 'placeholder': 'phone prefix' }}) }}
            <div class="err-msg">{{ form_errors(form.phonePrefix, { 'attr': { 'class': 'err-msg' } }) }}</div>
        </div>
        <div class="col-xs-4">            
            {{ form_widget(form.phone, { 'attr': { 'class': 'text-line-fill', 'placeholder': 'phone number' }}) }}
            <div class="err-msg">{{ form_errors(form.phone, { 'attr': { 'class': 'err-msg' } }) }}</div>
        </div>        
        
    </div>

    
    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-6">                        
            {{ form_widget(form.accept) }}
            <label for="form_accept"><span></span>
                  ich habe die <a href="{{ path('kundeninfos_agb') }}" target="_blank">AGB</a> gelesen und stimme diesen zu.
            </label>
        </div>
        <div class="err-msg">{{ form_errors(form.accept) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-2">                        
            {{ form_widget(form.timeMorning) }}
            <label for="form_timeMorning"><span></span>vormittags</label>
        </div>
        <div class="col-xs-2">                        
            {{ form_widget(form.timeAfternoon) }}
            <label for="form_timeAfternoon"><span></span>nachmittags</label>
        </div>                    
        <div class="col-xs-2"> 
            {{ form_widget(form.timeEvening) }}
            <label for="form_timeEvening"><span></span>abends</label>
        </div>
        <div class="col-xs-3"> 
            {{ form_widget(form.timeWeekend) }}
            <label for="form_timeWeekend"><span></span>wochenende</label>
        </div>
    </div>

    
    <div class="row">
        <div class="col-xs-2">
            <label ></label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.optClient) }}
            <label for="form_optClient"><span></span>Ja, ein Treffpunkt beim Kunden ist möglich</label>
        </div>
    </div>
            
    <div class="row">
        <div class="col-xs-2">
            <label >gruppenstunden</label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.optGroup) }}
            <label for="form_optGroup"><span></span>Ja, biete ich an</label>
        </div>
    </div>
            
    <div class="row">
        <div class="col-xs-2">
            <label >abgeschlossene ausbildungen, zertifikate oder referenzen</label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.descReference, { 'attr': { 'class': 'admin-edit-area', 'placeholder': 'Maximal 500 Zeichen verfügbar' } }) }}
        </div>
        <div class="err-msg">{{ form_errors(form.descReference) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >angebotsumfang</label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.descScope, { 'attr': { 'class': 'admin-edit-area','placeholder': 'Maximal 500 Zeichen verfügbar' } }) }}
        </div>
        <div class="err-msg">{{ form_errors(form.descScope) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >für wen ist dein angebot besonders geeignet?</label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.descTarget, { 'attr': { 'class': 'admin-edit-area','placeholder': 'Maximal 500 Zeichen verfügbar' } }) }}
        </div>
        <div class="err-msg">{{ form_errors(form.descTarget) }}</div>
    </div>
    
    <div class="row">
        <div class="col-xs-2">
            <label >spezielle angebotskonditionen</label>
        </div>
        <div class="col-xs-8">                        
            {{ form_widget(form.descCondition, { 'attr': { 'class': 'admin-edit-area','placeholder': 'Schreib hier, falls du dein Angebot zu speziellen Geschäftsbedingungen anbieten möchtest. Maximal 1000 Zeichen verfügbar' } }) }}
        </div>
        <div class="err-msg">{{ form_errors(form.descCondition) }}</div>
    </div>
                
            
<input type="submit" class="button-black backgound-yellow text-black" value="Save">
<a class="button-black backgound-yellow text-black" href="{{ path('admin_talent_list') }}">Cancel</a>
</div>
{{ form_end(form) }}
            
  <div id="cropper-modal" class="modal fade">
      <div class="modal-dialog">
          <div class="modal-content" >
              <div class="modal-header" style="height: 50px;">
                <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.png" alt="close"/></button>
              </div>
              <div class="modal-body">
                  <div class="image" style="width: 600px; height: 400px; overflow: hidden;">
                  </div>
              </div>
              <div class="modal-footer">
                  <button class="save button-black backgound-yellow text-black">save</button>
              </div>
            </div>
      </div>
  </div>
        
{% endblock %}

{% block script %}
  <script src="/js/vendors/upload/jquery.knob.js"></script>
  <script src="/js/vendors/upload/jquery.ui.widget.js"></script>
  <script src="/js/vendors/upload/jquery.iframe-transport.js"></script>
  <script src="/js/vendors/upload/jquery.fileupload.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/js/jquery.color.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/js/jquery.Jcrop.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/css/jquery.Jcrop.min.css"/>
  
    <script>        
        var jcropApi = null;
        
        function showCoords(c) {
            console.log(Math.round(c.x) + ', ' + Math.round(c.y) + ', ' + Math.round(c.x2) + ', ' + Math.round(c.y2) + ', ' + Math.round(c.w) + ', ' + Math.round(c.h));
        }
        
        function deleteImage(e) {
            e.preventDefault();
            
            var $this = $(this);
            var iid = $this.data('id');
            var url = '{{ path('admin-talent-image-delete', { 'tid': 'TID', 'iid': 'IID' }) }}'.replace('TID', '{{ talent.id }}').replace('IID', iid);
            $.getJSON(url)
                    .done(function(data) {
                        $this.parents('li.thumb').remove();
                    })
                    .fail(function() {
                        alert('Fehler beim Entfernen des Bildes. Bitte versuche es erneut.');
                    })
                    .always(function() {
                        refreshCtrl();
                    });
        }
        function refreshCtrl() {
            if ($("#img-list li").length >= {{ max_num_images }}) {
                $("#drop").addClass('disabled');
            }
            else {
                $("#drop").removeClass('disabled');
            }
            if ($("#img-list-main li").length >= 1) {
                $("#drop-main").addClass('disabled');
            }
            else {
                $("#drop-main").removeClass('disabled');
            }
        }
        function setupJcrop() {
            var $img = $("#cropper-modal .modal-body img");
            var main = true;//$img.data('main');
            var params = {
                //onSelect: showCoords,
                //onChange: showCoords,
                boxWidth: 600,
                boxHeight: 400,
                keySupport: false,
                minSize: [750, 0],
                setSelect: [0, 0, 750, 563]
            };
            if (main) {
                params['aspectRatio'] = 4.0 / 3.0;
                params['minSize'] = [750, 563];
            }   
            
            
            $img.Jcrop(params, function() {
                jcropApi = this;
            });
            $("#img-list li.process, #img-list-main li.process").remove();
            $("#cropper-modal").modal({ 
                'backdrop': 'static' 
            });
        }
        
        function priceChanged() {
            var $price = $("#form_price");
            var price = parseInt($price.val());
            var $req = $("#form_requestPrice");
            var $reqHold = $req.parent(".chbox-holder");
            if (price >= 35) {
                $req.removeAttr('disabled');
                $reqHold.removeClass('rdisable');
            }
            else {
                $req.prop('checked', false);
                $req.attr('disabled', 'disabled');
                $reqHold.addClass('rdisable');
            }
        }
        function requestPriceChanged() {
            var $price = $("#form_price");
            var price = parseInt($price.val());
            var $req = $("#form_requestPrice");
            var req = $req.prop('checked');
            if (req) {
                $price.attr('readOnly', 'true');
                $price.css({ 'background-color': '#aaa', 'opacity': '0.5' });
            }
            else {
                $price.removeAttr('readOnly');
                $price.css({ 'background-color': '#fff', 'opacity': '1.0' });
            }
        }
        
        $(function() {
            
            $("#form_price").on('change keyup', priceChanged);
            $("#form_requestPrice").on('click change', requestPriceChanged);
          
            priceChanged();
            requestPriceChanged();  
            
            var ul = $('#upld ul');
            refreshCtrl();
        
            $("li.thumb a.remove").click(deleteImage);
            
            $('#drop a').click(function(){
                if ($("#img-list li").length >= {{ max_num_images }})
                    return;
                // Simulate a click on the file input button
                // to show the file browser dialog
                $(this).parent().find('input').click();
            });
            $('#drop-main a').click(function(){
                if ($("#img-list-main li").length >= 1)
                    return;
                // Simulate a click on the file input button
                // to show the file browser dialog
                $(this).parent().find('input').click();
            });
            
            $("#cropper-modal .save").click(function() {
                var $img = $("#cropper-modal .modal-body img");
                var rect = jcropApi.tellSelect();
                var name = $img.data('name');
                var main = $img.data('main');
                var url = '{{ path('admin-talent-main-image-save') }}';
                var params = {
                    'name': name,
                    'x': Math.round(rect.x),
                    'x2': Math.round(rect.x2),
                    'y': Math.round(rect.y),
                    'y2': Math.round(rect.y2),
                    'id': {{ talent.id }},
                    'main': main
                };
                $.getJSON(url, params)
                    .done(function(data) {
                        $("#cropper-modal").modal('hide');
                        
                        var url = data.url;
                        var imgId = data.imgId;
                        var main = data.main;
                        var tmpl = '<li class="thumb">' + 
                                    '<a href="' + url + '" target="_blank" title="öffnen"><img src="' + url + '" alt="öffnen"/></a>' +
                                    '<br/>' +
                                    '<a href="#" class="remove" data-id="' + imgId + '" title="löschen"><img src="/img/icons/delete.png" alt="löschen"/></a>' +
                                    '</li>';
                        
                        var $html = $(tmpl);
                        if (main)
                            $("#img-list-main").append($html);
                        else
                            $("#img-list").append($html);
                        $html.find("a.remove").click(deleteImage);
                    })
                    .fail(function(data) {
                        alert('Bildverarbeitung fehlgeschlagen. Bitte versuche es erneut.');
                    })
                    .always(function() {
                        refreshCtrl();
                    });
            });

            $('#upld-main').fileupload({

                // This element will accept file drag/drop uploading
                dropZone: $('#drop-main'),

                // This function is called when a file is added to the queue;
                // either via the browse button, or via drag/drop:
                add: function (e, data) {
                    var tmpl = '<li class="thumb process"><div class="gauge"><input class="knob" type="text" value=""/></div><div class="status">0%</div></li>';
                    var $html = $(tmpl);
                    $(this).find("#img-list-main").append($html);
                    data.context = $html;
                    $html.find('input').knob({
                        width: 48,
                        height: 48,
                        inputColor: '#000',
                        displayInput: false,
                        min: 0,
                        max: 100,
                        readOnly: true
                    });
                    
                    // Automatically upload the file once it is added to the queue
                    var jqXHR = data.submit();
                },

                progress: function(e, data){

                    // Calculate the completion percentage of the upload
                    var progress = parseInt(data.loaded / data.total * 100, 10);

                    // Update the hidden input field and trigger a change
                    // so that the jQuery knob plugin knows to update the dial
                    data.context.find('input').val(progress).change();
                    data.context.find('.status').text(progress + '%');

                    if (progress == 100)
                        data.context.find('.status').text('Verarbeitung...');
                },

                done: function(e, data) {
                    var url = data.result.url;
                    var name = data.result.name;
                    var w = data.result.width;
                    var h = data.result.height;
                    var main = true;
                    
                    
                    var $img = $("<img>").one('load', setupJcrop).attr('src', url).data('name', name).data('main', main);
                    $("#cropper-modal .image").empty();
                    $("#cropper-modal .image").append($img);
                    //$("#cropper-modal").modal();
                                        
                    data.context.find('.status').text('Verarbeitung...');
                },

                fail:function(e, data){
                    // Something has gone wrong!
                    alert(data.jqXHR.responseJSON.message);
                    // remove progress li
                    $("#img-list li.process, #img-list-main li.process").remove();
                }

            });
            $('#upld').fileupload({

                // This element will accept file drag/drop uploading
                dropZone: $('#drop'),

                // This function is called when a file is added to the queue;
                // either via the browse button, or via drag/drop:
                add: function (e, data) {
                    var tmpl = '<li class="thumb process"><div class="gauge"><input class="knob" type="text" value=""/></div><div class="status">0%</div></li>';
                    var $html = $(tmpl);
                    $(this).find("#img-list").append($html);
                    data.context = $html;
                    $html.find('input').knob({
                        width: 48,
                        height: 48,
                        inputColor: '#000',
                        displayInput: false,
                        min: 0,
                        max: 100,
                        readOnly: true
                    });
                    
                    // Automatically upload the file once it is added to the queue
                    var jqXHR = data.submit();
                },

                progress: function(e, data){

                    // Calculate the completion percentage of the upload
                    var progress = parseInt(data.loaded / data.total * 100, 10);

                    // Update the hidden input field and trigger a change
                    // so that the jQuery knob plugin knows to update the dial
                    data.context.find('input').val(progress).change();
                    data.context.find('.status').text(progress + '%');

                    if (progress == 100)
                        data.context.find('.status').text('Verarbeitung...');
                },

                done: function(e, data) {
                    var url = data.result.url;
                    var thumbUrl = data.result.thumbUrl;
                    var imgId = data.result.imgId;
                    var tmpl = '<li class="thumb">' + 
                                '<a href="' + url + '" target="_blank" title="öffnen"><img src="' + thumbUrl + '" alt="öffnen"/></a>' +
                                '<br/>' +
                                '<a href="#" class="remove" data-id="' + imgId + '" title="löschen"><img src="/img/icons/delete.png" alt="löschen"/></a>' +
                                '</li>';
                    var $html = $(tmpl);
                    
                    data.context.remove();

                    $("#img-list").append($html);
                    $html.find("a.remove").click(deleteImage);
                    refreshCtrl();
                },

                fail:function(e, data){
                    // Something has gone wrong!
                    if (data.jqXHR.hasOwnProperty('responseJSON'))
                        alert(data.jqXHR.responseJSON.message);
                    else 
                        alert('Es gab einen Fehler beim Hochladen der Bilder. Bitte versuch es noch einmal.');
                    // remove progress li
                    data.context.remove();
                }

            });

            // Prevent the default action when a file is dropped on the window
            $(document).on('drop dragover', function (e) {
                e.preventDefault();
            });
        });
    </script>
{% endblock %}

