{% extends 'base.html.twig' %}

{% block home_header %}{% endblock %}

{% block body %}
    {% include('provider/user_nav.html.twig') %}
  <section class="users container background-light-grey">
    <div class="row">
        <!-- Left side -->
        <div class="col-xs-9">
            <a href="{{ path('dashboard') }}"><img src="/img/logo-small.png" alt=""/></a>
            <ul class="steps">
               <li class="step-1"><span class="counters text-bold"><span class="n-one"></span>Tarif</span></li>
                  <li class="step-2"><span id="button_2" class="{% if (complete) %}top-menu-button{% endif %} counters greyed"><span class="nh-two"></span>Beschreibung</span>
                  </li>
                  <li class="step-3"><span id="button_3" class="{% if (complete) %}top-menu-button{% endif %} counters greyed"><span class="nh-three"></span>Details</span></li>
                  <li class="step-4"><span id="button_4" class="{% if (complete) %}top-menu-button{% endif %} counters greyed"><span class="nh-four"></span>Fertig</span></li>
            </ul>
        </div>
        <!-- Right side -->
         <div class="col-md-3 margin-rwd">
        <div class="support">
          <p class="head">Anbieter Support</p>
          <p class="mail"><a href="mailto:support@heysharing.com">support@heysharing.com</a></p>
        </div>
      </div>
    </div>
    <div class="row user-forms">
        <div class="col-xs-9">                
            <div class="row">
                <div class="col-xs-12 border-bottom-white form-head">
                    <div class="form-container">
                        <div class="row">
                            <div class="col-sm-12">
                                <span class="number-one"></span>

                                <p class="form-heading">Tarif</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-container form-input form-last-item">
                        <div class="row">
                             <div class="col-sm-12">
                                 <div id="basic-form">
                                    {{ render(controller('AppBundle:Talent:formBasic', { 'id': id })) }}
                                 </div>
                              </div>
                        </div>                         
                    </div>
                </div>
                
                <div class="col-xs-12 border-bottom-white form-head">
                    <div class="form-container">
                        <div class="row">
                            <div class="col-sm-12">
                                <span class="number-two"></span>
                                <p class="form-heading">Tarifoptionen</p>
                            </div>
                        </div>
                    </div>
                </div>
                              
                <div class="col-xs-12">
                    <div class="form-container form-input form-last-item">
                        <div id="tariff-form">
                            {{ render(controller('AppBundle:Talent:formTariff', { 'id': id, 'type': type })) }}
                        </div>
                    </div>                     
                </div>                              
            </div>
            <input type="submit" id="basic-submit" class="yellow-button" value="Tarif speichern &gt;&gt;">
        </div>
        <!--<div class="col-xs-3">
            <div class="support">
                <p class="head">Dein Verdienst</p>
                <div class="range"><input type="text" id="range_30" name="example_name" value="" /></div>
                <p class="price">29,90 €</p>
                <p class="price-info">pro Jahr bei 50 Stunden Vermietung</p>
            </div>
        </div>-->
  </section>
  </div>

    <div id="edit-offer" class="modal fade delete-offer" role="dialog">
      <div class="modal-dialog"> 
        <!-- Modal content-->
        <div class="modal-content">
          <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.png" alt="close"/></button>
          <div class="content-modal">
            <p class="text-bold">Das Angebot wurde bearbeitet.</p>
            <p class="delate-info">Bitte beachte, dass dein Angebot erst von uns angesehen werden muss, bevor die Änderungen aktiv werden.</p>
        </div>
      </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        
        $(function() {
            initBasicForm();
            initTariffForm();
        }); // end of ready
        
        function initTariffForm() {
            var $tariffPicker = $("#form_type");
            $tariffPicker.selectpicker({
                width: 200,
                style: 'btn-info'
            });
            $tariffPicker.on('changed.bs.select', tariffChanged);
            $("#tariff-save").click(tariffSave);
        }
        function initBasicForm() {
            $("#basic-submit").click(basicSubmit);            
        }
        function tariffChanged() {
            var type = $("#form_type").selectpicker('val');
            var url = '{{ path('talent-detail-form', { 'id': id, 'type': '-TYPE-' }) }}';
            url = url.replace('-TYPE-', type);
            
            $("#tariff-form").load(url, function() {
                initTariffForm();
            });
        }
        function tariffSave(e) {
            e.preventDefault();
            
            var $form = $('#tariff-form form');
            if ($form[0].checkValidity())
                $form.ajaxSubmit({
                    target: $('#tariff-form'),
                    success: function() { 
                        initTariffForm();
                        console.log('tariff form success'); 
                    }
                });
            else
                $('<input type="submit">').hide().appendTo($form).click().remove();
        }
        function basicSubmit(e) {
            e.preventDefault();
            
            var $form = $('#basic-form form');
            if ($form[0].checkValidity())
                $form.ajaxSubmit({
                    target: $('#basic-form'),
                    success: function() { 
                        initBasicForm();
                        console.log('basic form success'); 
                    }
                });
            else 
                $('<input type="submit">').hide().appendTo($form).click().remove();
        }
        {#
      var fieldsChanged = false;
      var url2 = "{{ path('talent-edit-2', {'id': id}) }}";
      var url3 = "{{ path('talent-edit-3', {'eqid': id}) }}";
      var url4 = "{{ path('talent-edit-4', {'id': id}) }}";
      
      function topMenuClick(){
          
          if (!fieldsChanged || confirm('Sie haben ungesicherte Änderungen. Möchtest du fortfahren?')){
              switch($(this).attr("id").split("_")[1]){
                  case "2":
                      location.href = url2;
                      break;
                  case "3":
                      location.href = url3;
                      break;
                  case "4":
                      location.href = url4;
                      break;
              }
              
          } 
      }
      function priceChanged() {
          var $price = $("#form_price");
          var price = parseInt($price.val());
          var $req = $("#form_requestPrice");
          var $reqHold = $req.parent(".chbox-holder");
          if (price >= 35) {
              $req.removeAttr('disabled');
              $reqHold.removeClass('rdisable');
          }
          else {
              $req.prop('checked', false);
              $req.attr('disabled', 'disabled');
              $reqHold.addClass('rdisable');
          }
      }
      function requestPriceChanged() {
          var $price = $("#form_price");
          var price = parseInt($price.val());
          var $req = $("#form_requestPrice");
          var req = $req.prop('checked');
          if (req) {
              $price.attr('readOnly', 'true');
              $price.css({ 'background-color': '#aaa', 'opacity': '0.5' });
          }
          else {
              $price.removeAttr('readOnly');
              $price.css({ 'background-color': '#fff', 'opacity': '1.0' });
          }
      }
      #}
          {# 
      
      $(document).ready(function () {
          $("form input[type='text']").on("change", function(){
              fieldsChanged = true;
          });
          
          $(".top-menu-button").click(topMenuClick);
          $("#form_price").on('change keyup', priceChanged);
          $("#form_requestPrice").on('click change', requestPriceChanged);
          
        priceChanged();
        requestPriceChanged();  
          
        {% if statusChanged %}
            $("#edit-offer").modal();
            $("#edit-offer").on("hidden.bs.modal", function() {
                window.location = '{{ path('talent-edit-2', { 'id': id }) }}';
            });
        {% endif %}
      });
        #}
  </script>
{% endblock %}
