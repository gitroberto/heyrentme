{{ form_start(form) }}
    <input type="hidden" name="success" value="{{ form.vars.submitted and form.vars.valid ? "1" : "0" }}"/>
    <div class="row">
        <div class="col-sm-6">
            <label for="form_type">Einheit wählen:</label>
           {{ form_widget(form.type) }}
        </div>
        <div class="col-sm-6 adjust-to-rabatt">
            <label for="form_price">Preis pro Std. ab:</label>
            {{ form_widget(form.price, { 'attr': { 'class': 'small-input text-box short', 'placeholder': '0' }}) }}EUR
            {% if form.price.vars.errors|length > 0 %}<div class="err-msg">{{ form_errors(form.price) }}</div>{% endif %}
        </div>
    </div> 
    <div class="row">
        <div class="col-xs-12">
            <p class="memo">
                Bitte gib hier Tarif (bist du Umsatzsteuerpflichtig inkl. Ust.) für diese Einheit an. Sollte es bei einer Buchung zu gefingfügigen Mehrkosten kommen, kannst du das dem Kunden separat mitteilen.
            </p>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="chbox-holder" style="display: inline-block;">
                {{ form_widget(form.requestPrice, { 'attr': { 'class': 'small-input text-box short', 'placeholder': '0' }}) }}
                <label for="form_requestPrice"><span></span>Preis nur auf Anfrage*</label>
                {% if form.requestPrice.vars.errors|length > 0 %}<div class="err-msg">{{ form_errors(form.requestPrice) }}</div>{% endif %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <p class="memo">
                *Diese Option ist nur für Stundentarife ab 35,- EUR vorgesehen. Bitte bestätige dazu erst deinen Stundentarif. Bitte beachte, dass es fur Kunden generell vorteilhafter ist, wenn ein Tarif angegeben wird.
            </p>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-6">
            <div class="chbox-holder" style="display: inline-block;">
                {{ form_widget(form.discount) }}
                <label for="form_discount"><span></span>Mengenrabatt ab:</label>
            </div>
            {% if form.discount.vars.errors|length > 0 %}<div class="err-msg">{{ form_errors(form.discount) }}</div>{% endif %}
            {{ form_widget(form.discountMinNum) }}
            {% if form.discountMinNum.vars.errors|length > 0 %}<div class="err-msg">{{ form_errors(form.discountMinNum) }}</div>{% endif %}
        </div>
        <div class="col-sm-6">
            <div class="chbox-holder" style="display: inline-block;">
                <label for="form_discountPrice">Rabatt-Preis pro Std. ab:</label>
            </div>
                {{ form_widget(form.discountPrice, { 'attr': { 'class': 'small-input text-box short', 'placeholder': '0' }}) }}EUR
           
            {% if form.discountPrice.vars.errors|length > 0 %}<div class="err-msg">{{ form_errors(form.discountPrice) }}</div>{% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <button id="tariff-save">Diese Tarifoption speichern</button>
            {% if tariffId %}                                                                          
                <button id="tariff-delete" data-id="{{ tariffId }}">Diese Tarifoption zurücksetzen und entfernen</button>
            {% endif %}
        </div>
    </div>
{{ form_end(form) }}

<script>
    function priceChanged() {
        var $price = $("#form_price");
        var price = parseInt($price.val());
        var $req = $("#form_requestPrice");
        var $reqHold = $req.parent(".chbox-holder");
        if (price >= 35) {
            $req.removeAttr('disabled');
            $reqHold.removeClass('rdisable');
        }
        else {
            $req.prop('checked', false);
            $req.attr('disabled', 'disabled');
            $reqHold.addClass('rdisable');
        }
    }
    function requestPriceChanged() {
        var $price = $("#form_price");
        var price = parseInt($price.val());
        var $req = $("#form_requestPrice");
        var req = $req.prop('checked');
        if (req) {
            $price.attr('readOnly', 'true');
            $price.css({ 'background-color': '#aaa', 'opacity': '0.5' });
        }
        else {
            $price.removeAttr('readOnly');
            $price.css({ 'background-color': '#fff', 'opacity': '1.0' });
        }
    }
    function discountChanged() {
        var $dcnt = $('#form_discount');
        var $dcntNum = $('#form_discountMinNum');
        var $dcntPrice = $('#form_discountPrice');
        if ($dcnt.prop('checked')) {
            $dcntPrice.removeAttr('readOnly');
            $dcntPrice.css({ 'background-color': '#fff', 'opacity': '1.0' });
            $dcntNum.prop('disabled', false);
            $dcntNum.selectpicker('refresh');
        }
        else {
            $dcntPrice.attr('readOnly', 'true');
            $dcntPrice.css({ 'background-color': '#aaa', 'opacity': '0.5' });
            $dcntNum.prop('disabled', true);
            $dcntNum.selectpicker('refresh');
        }        
    }
    $(function () {
        $("#form_price").on('change keyup', priceChanged);
        $("#form_requestPrice").on('click change', requestPriceChanged);          
        $("#form_discount").on('click change', discountChanged);
        priceChanged();
        requestPriceChanged();
        window.setTimeout(discountChanged, 123); // todo: improve (call after $('.num-picker').selectpicker())
    });
</script>
