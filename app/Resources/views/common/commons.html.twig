<div class="modal fade delete-offer" id="pls-wait" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.png" alt="close"/></button>
            <div class="content-modal">
                <p class="text-bold">Processing ....</p>
                <p class="text-bold">Please wait</p>
            </div>
        </div>
    </div>
</div>

<div id="choose-offer" class="modal fade delete-offer" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.png" alt="close"/></button>

            <div class="content-modal">
                <p class="text-bold">Was möchtest du anbieten?</p>
                <p class="delate-info">Hier kannst du entweder ein Equipment oder dein
                    Talent bzw. eine Dienstleistung anbieten! 
                    (Siehe <a href="/doc/checklist.pdf" target="_blank">Checklist</a>)
                </p>
                {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                    <a href="#" data-toggle="modal" data-target="#choose-category" class="button-black backgound-yellow text-black">Equipment Anbieten</a>
                {% else %}
                    <a href="{{ path('rental') }}" class="button-black backgound-yellow text-black">Equipment Anbieten</a>
                {% endif %}
                <a href="#" class="button-black backgound-yellow text-black">Talent Anbieten</a>
            </div>
        </div>
    </div>
</div>

<div id="choose-category" class="modal fade delete-offer" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.svg" alt="close"/></button>

            <div class="content-modal">
                <p class="text-bold">Bitte wähle eine Kategorie</p>
                <p class="delate-info">Bitte wähle eine Haupt- und Detailkategorie, damit wir dein Angebot zuordnen können.</p>
                <div class="clearfix">
                  <select title='Hauptkategorie' id="category" name="category" class="selectpicker bs-select-hidden ">
                      {% for cat in categories %}
                          <option value="{{ cat.id }}">{{ cat.name }}</option>
                      {% endfor %}
                  </select>
                  <select title='Detailcategorie' name="subcategory" id="subcategory" class="selectpicker bs-select-hidden" disabled="disabled">
                  </select>
                </div>
                <div>
                  <a href="#" id="weiter" class="button-black backgound-yellow text-black" disabled="disabled">Weiter</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="hey-garantie" class="modal fade delete-offer" role="dialog">
  <div class="modal-dialog"> 
    <!-- Modal content-->
    <div class="modal-content">
      <button type="button" class="close" data-dismiss="modal"><img src="/img/close-modal.png" alt="close"/></button>
      <div class="content-modal">
        <p class="text-bold">Nutze die hey! Garantie</p>
        <p class="modal-long-text">Beim Einstellen deines Equipments fragen wir dich nach dem Wert des Equipments oder du kannst angeben, dass du über eine Original-Rechnung verfügst. Wurde dein Equipment beschädigt und der Fall übersteigt den Wert der von dir festgelegten Kaution (z.B. Die Kaution beträgt 200,- der Schaden liegt aber bei 1.000,- €), so wende dich bitte an uns. Wir überprüfen den Fall und erstatten dir den Schadenswert bis zu 750,- € unkompliziert und schnell zurück.<br>
          <br>
          Wichtig sind dabei die saubere Dokumentation und Übermittlung des Übergabeprotokolls, Ausleihvereinbarung und entsprechenden Angaben zum Fall wie Bilder, Beschreibung des Hergang. Wir empfehlen auch die vorherige Konsultation der Haushaltsversicherung zwecks Deckung des Schadens. <br>
          <br>
          Wir bieten diesen Service nach einem Fair-Use Prinzip an. Sollte sich bei Überprüfung herausstellen, dass ein Mißbrauch vorliegt, können wir das Service nicht anbieten. Mehr dazu findest du auch in unseren 
          <a href="{{ path("kundeninfos_agb") }}" target="_blank">AGB</a>. 
          Falls noch weitere Fragen zur Garantie bestehen schreibe uns bitte eine Mail an <a href="mailto:support@heysharing.com">support@heysharing.com</a>.</p>
      </div>
    </div>
  </div>
</div>
                      
{# TODO: possibly move script to external .js file (watch out for the twig-logic (if's)! #}
<script>
    $(function() {
        $("weiter").attr('disabled', 'disabled');
        
        $("#category").change(function() {
            var id = $("#category").val();
            var url = '{{ path('subcat', { 'id': 'CAT_ID' }) }}'.replace('CAT_ID', id.toString());           
            var subsel = $("#subcategory");
            $.getJSON(url)
                .done(function(json) {
                    subsel.empty();
                    subsel.attr('disabled', 'disabled').selectpicker('refresh');
                    $.each(json, function(index, item) {
                        var opt = $("<option>").attr('value', item.id).text(item.name);                   
                        subsel.append(opt);
                    });
                    subsel.removeAttr('disabled').selectpicker('refresh');
                })
                .fail(function(jqxhr, textStatus, error) {
                    var err = textStatus + ", " + error;
                    console.log("Request Failed: " + err);
                    alert("Subcategories cannot be loaded, please try again.");
                    subsel.attr('disabled', 'disabled').selectpicker('refresh');
                });
        });
        
        $("#subcategory").change(function() {
            var butt = $('#weiter');
            if ($("#subcategory").is(":selected"))
                butt.removeAttr('disabled');
            else
                butt.attr('disabled', 'disabled');
        });
        
        $("#weiter").click(weiterClick);
    });
    
    function anbieten(categoryId) {
        // preselect current category
        if (typeof categoryId === 'number') {
            var $sel = $('#category');
            $sel.val(categoryId.toString()).selectpicker('refresh');
            $sel.change();
            $('#weiter').attr('diabled', 'disabled');
        }
        $("#choose-category").modal();
    }
    {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
        function weiterClick() {
            var id = $("#subcategory").val();
            var url = '{{ path('equipment-add-1', { 'categoryId': 'SUBCAT_ID' }) }}'.replace('SUBCAT_ID', id);
            window.location = url;
        }
    {% else %}
        function weiterClick() {
            var id = $("#subcategory").val();
            var url = '{{ path('rental-detail', { 'categoryId': 'SUBCAT_ID' }) }}'.replace('SUBCAT_ID', id);
            window.location = url;
        }
    {% endif %}
</script>
